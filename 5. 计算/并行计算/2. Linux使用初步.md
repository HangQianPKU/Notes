## 并行与分布式计算基础|专题（2）Linux使用初步

### 引言

集群或者说所谓的“服务器”，统统是使用Linux系统的，而且很少使用常见的Ubuntu发行版。**（一般用啥呢，为何？）**

此外，在集群上图形界面默认是关闭状态，通常不会安装臃肿的图形界面。尽管我们可以通过X11转发（X使用的C/S模型使得我们可以通过在本地自建X Server、将集群服务器作为client的方式建立通信）或者VNC的方式来实现图形界面的使用，但由于这些方法的延迟较高，对于Linux命令行界面的掌握是必要的。我们对于命令行基本操作的介绍不会追求全面完整，仅仅会对集群使用中的必要操作进行提及，

另外，这里还将结合作者课题组中使用的服务器进行集群相关操作的讲解。

### Shell交互

- Shell是个啥
- Shell相比图形界面
- Shell中主机名目录位置为何如此重要——跳出原本日常操作的思维习惯
- 快捷操作方式

就像前面说的，在服务器上使用图形界面要面对非常高的延迟。此外，Shell命令行相对于图形界面也有其自身的优势所在：例如，在Shell上我们的大部分命令都是通过键盘完成的，并不需要鼠标的参与；此外在完成大量的重复操作方面，Shell也有其不可比拟的优势。

所谓Shell其实就是一个命令行**窗口**,

```Linux
[qianh   @    admin   ~]$   ls -al

 我是谁        我在哪          我在干什么
```

对命令行进行操作时，除了常规字符的输入之外，许多快捷键也是非常好用的，他们能够极大地提高我们的使用效率：

- TAB 补全命令。
- CTRL + C 中止当前命令。当然，严格来说，“中止”的说法并不准确，
- CTRL + Z
- 

### 目录结构

- Linux中的树结构——对应的概念，例如挂载
- 与windows的区别——磁盘分区balabal
- 对应操作——cd , pwd, 

Linux的文件目录结构与Windows有很大的不同，前者被称为“树结构”，

### 文件与目录结构



- 文件的编辑器 ——多种，例如vi,例如seg，等等  
  - 关于vi 的介绍
- 万物皆文件——例如输入输出设备；程序（这能结合ICS来写吗）
- 文件基本操作—— cat cp mv rm(重命名和移动的本质是一样的)
  - mv 有复制以及移动（新建） 以及移动到指定目录



#### 文件编辑器

注意：当你使用vi打开一个不存在的文件，vi会首先帮你创建一个空文件，然后打开它——这有时候会造成误会。



- **删除文件或目录**

  **强调强调再强调，Linux和windows不同，Linux系统没有所谓的回收站，文件一旦删除就不会回来了！**。因此在项目中，一般的操作是建立一个delete文件目录，使用前面提到的mv操作并且定期对其中文件进行删除。

  删除操作的命令是rm，删除文件的语法如下：

  ```shell
  $ rm [optional]... filename ...
  ```

  filename后面的省略号表明我们可以输入多个文件名，实现多个文件的同时删除。当然，很多情况下通配符*可以快速提高效率。

  如果需要删除目录，则使用：

  ```shell
  $ rmdir [optianal]... dirname ...
  ```

  但实际上rmdir的用处并不大，当待删除目录非空时，Shell会报错：Dictionary is not empty!

  删除非空目录需要如下命令：

  ```shell
  $ rm -r dirname
  ```

  -r表示recursive，即递归地删除目录及其中包含的子文件和子目录。

  对了，有一个在网络上广为流传的段子，据说轻则

  ```shell
  $ rm -rf /
  ```

  其中-f的含义是force强制执行，在删除操作时忽略任何提示（prompt))直接进行。我们接下来会提到权限，例如对于有些仅有只读权限的文件，删除文件是嗯，看上去的确是一个非常可怕的操作，但事实上在较新版的Linux上，根目录是会保留的——真正的斩草除根命令应该是:

  ```shell
  $ rm -rf / --no-preserve-root
  ```

  感兴趣的读者可以试试这个命令XD



### 用户与权限

- 再次强调这是一个多用户的工作环境，因此需要权限
- 关于用户： 用户，用户组，全部
- 用户的分类：
- 管理员
- 关于文件的权限—— 只读 ，修改 ， 执行
- 关于目录的权限 —— 只读，修改，执行



- 权限：三种类型的权限：只读（r), 写入（w), 执行（x)。注意三者对于文件和目录表示不同的含义。

  - 只读：在文件中，只读表示可以查看文件的内容。对于目录，则表示是否可以读取其中的文件列表

  - 写入：对于文件，写入权限表示修改文件内容，而目录的写入则是在目录中添加或删除。

  - 执行：注意执行与只读的区别：前者只能查看不能执行，不可读的文件是不可执行的（那是自然），但是不可执行的文件是可以读的。另外对于目录而言，执行则意味着是否可以移动到此目录下————目录的只读和执行权限同样容易让人搞混，举个例子，对于一个用户具有执行权限而不具有只读权限的目录，我们可以进入该目录，却不能ls其中包含的文件；而对于具有只读权限却没有执行权限的目录，我们无法进入该目录，却可以在该目录外通过指向该目录的路径ls出该目录下一级的子文件与子目录。

    有意思的问题
    1.将文本文件的r权限关闭后（w和x权限依然保持），用vi打开
    啥都看不了——很正常。但是退不出来
    用q退出：不行
    用wq退出：不行——自然zz也不可以
    用q！退出：可以

- 查看权限，修改权限

```shell
chmod u-r test
chmod g+w text
chmod o=x text
```

或者采用三个八进制数的表示：

```shell
chmod 766 test
```



### 编译

- 关于编译型语言与解释型语言

- 广义的编译 ： 预处理 编译  汇编 链接

  - 预处理：加入头文件
- 编译：
  - 汇编：可重定向目标文件
- 链接：将多个目标文件以及库函数打包成一个，得到可执行文件



总的来说，编程语言可以分为编译型语言和解释型语言两种，前者的典型是C和Pascal，后者的典型则是Java与python
不如有空玩玩Java。





### 程序的运行





### 作业调度系统——以PBS和Slurm为例

打开PBS文件：

```shell
#PBS -N Benchmark
#PBS -l nodes=6:ppn=16
#PBS -l walltime=300:00:00

echo This jobs is $PBS_JOBID@$PBS_QUEUE
cd $PBS_O_WORKDIR

mpirun -np 96 -machinefile $PBS_NODEFILE ./CitcomS-3.1.1/bin/CitcomSFull ./input_stokes
```

slurm文件：

```shell
#!/bin/bash

#SBATCH -o job_%j.out
#SBATCH --partition=cpu
#SBATCH -J mpi-ex1
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=4
#SBATCH --cpus-per-task=1
#SBATCH -t 10:00

# you'll need mpich to run this job
mpiexec -n 4 ./hello
#mpiexec -n 2 ./pingpong
```







<!--stackedit_data:
eyJoaXN0b3J5IjpbNjI2MTU2N119
-->